(function(){var global=window;if(global.module==undefined)global.module=function(n,t){var o=global[n];if(o==undefined)global[n]=o={};t(o)};
module("Charts",function(n){var t;t=function(){function f(a){var c,b,d,e;b={};e=f.DEFAULTS;for(c in e){d=e[c];b[c]=d}for(c in a){d=a[c];if(a.hasOwnProperty(c))b[c]=d}return b}f.DEFAULTS={dot_size:5,dot_color:"#00aadd",dot_stroke_color:"#fff",dot_stroke_size:2,line_width:3,line_color:"#00aadd",smoothing:0.4,fill_area:true,area_color:"#00aadd",area_opacity:0.2,show_x_labels:true,show_y_labels:true,label_max:true,label_min:true,max_x_labels:10,max_y_labels:3,x_label_size:14,y_label_size:14,label_format:"%m/%d",
show_grid:false,x_padding:45,y_padding:40};return f}();var o;o=function(){function f(){}f.get_ranges_for_points=function(a){var c,b,d,e,g;b=[];d=[];e=0;for(g=a.length;e<g;e++){c=a[e];b.push(c.x);d.push(c.y)}a=Math.max.apply(Math.max,b);c=Math.max.apply(Math.max,d);b=Math.min.apply(Math.min,b);d=Math.min.apply(Math.min,d);return[a,b,c,d]};f.calc_scaling_factors=function(a,c,b,d){var e;e=a-c;return[(a*d-b*c)/e,(b-d)/e]};f.scale_points=function(a,c,b,d,e){var g,h,i,j,p,k;j=f.get_ranges_for_points(b);
g=j[0];i=j[1];h=j[2];j=j[3];d=f.calc_scaling_factors(g,i,a-d,d);a=d[0];d=d[1];h=f.calc_scaling_factors(h,j,c-e,e);e=h[0];g=h[1];h=[];i=0;for(k=b.length;i<k;i++){p=b[i];j=a+p.x*d;p=c-(e+p.y*g);h.push(new l(j,p))}return h};return f}();n.Scaling=o;var l;l=function(){function f(a,c){this.y=c;if(this.is_date(a)){this.x=a.getTime();this.is_date_type=true}else this.x=a}f.prototype.is_date=function(a){return Object.prototype.toString.call(a)==="[object Date]"};return f}();n.Point=l;var u,s=function(f,a){return function(){return f.apply(a,
arguments)}};Raphael.fn.triangle=function(f,a,c){c*=1.75;return this.path("M".concat(f,",",a,"m0-",c*0.58,"l",c*0.5,",",c*0.87,"-",c,",0z"))};u=function(){function f(a,c,b){var d,e;this.r=a;if(typeof b==="number")b=Math.round(b*100)/100;d=c.getBBox();e=d.x;a=d.y;d=e+d.width/2;this.popup=this.r.set();this.popup.push(this.r.rect(d-25,a-35,50,25,5));this.popup.push(this.r.triangle(d,a-10+4,4).rotate(180));this.popup.attr({fill:"rgba(0,0,0,.4)","fill-opacity":0,stroke:"transparent","stroke-width":0});
this.text=this.r.text(d,a-22.5,b);this.text.attr({fill:"#fff","font-size":14,"text-anchor":"middle",width:50,height:25,"fill-opacity":0,"font-weight":"bold"});this.popup.toFront();this.text.toFront();c.mouseover(s(function(){return this.show()},this));c.mouseout(s(function(){return this.hide()},this))}f.prototype.animate_opacity=function(a,c,b){if(b==null)b=200;return a.animate({"fill-opacity":c},b,s(function(){if(c===0){this.text.toBack();return this.popup.toBack()}},this))};f.prototype.hide=function(){this.animate_opacity(this.popup,
0);return this.animate_opacity(this.text,0)};f.prototype.show=function(){this.popup.toFront();this.text.toFront();this.animate_opacity(this.popup,0.8);return this.animate_opacity(this.text,1)};return f}();n.Tooltip=u;var v;v=function(){function f(a,c,b,d,e,g){this.r=a;this.x=c;this.y=b;this.text=d;this.format=e;this.size=g!=null?g:14}f.prototype.is_date=function(a){return Object.prototype.toString.call(a)==="[object Date]"};f.prototype.parse_date=function(){var a,c,b,d,e;c=this.format.match(/%([a-zA-Z])/g);
a=this.format;d=0;for(e=c.length;d<e;d++){b=c[d];a=a.replace(b,this.parse_format(b))}return a};f.prototype.meridian_indicator=function(a){return a.getHours()>=12?"pm":"am"};f.prototype.to_12_hour_clock=function(a){a=a.getHours()%12;return a===0?12:a};f.prototype.format_number=function(a){return Math.round(a*10)/10};f.prototype.parse_format=function(a){switch(a){case "%m":return this.text.getMonth()+1;case "%d":return this.text.getDate();case "%Y":return this.text.getFullYear();case "%H":return this.text.getHours();
case "%M":return this.text.getMinutes();case "%I":return this.to_12_hour_clock(this.text);case "%p":return this.meridian_indicator(this.text)}};f.prototype.draw=function(){this.element=this.r.text(this.x,this.y,this.is_date(this.text)?this.parse_date(this.text):typeof this.text==="number"?this.format_number(this.text):this.text);return this.element.attr({fill:"#333","font-size":this.size,"font-weight":"bold"})};return f}();(function(){function f(a,c,b,d,e){this.r=a;this.width=c;this.height=b;this.points=
d;this.options=e}f.prototype.draw=function(){var a,c,b,d,e,g,h,i,j;a=Math.round(this.points.length/this.options.step_size);c=this.height-this.options.y_padding;e=this.width-this.options.x_padding;i=Math.round(c/a);h=this.options.y_padding;d=this.r.set();g=this.points;b=0;for(j=g.length;b<j;b++)if(b%this.options.step_size===0){g=this.points[b].x;d.push(this.r.path("M "+g+", "+this.options.y_padding+" L "+g+", "+c+" Z"))}for(b=0;0<=a?b<=a:b>=a;0<=a?b++:b--){h<=c&&d.push(this.r.path("M "+this.options.x_padding+
", "+h+" L "+e+", "+h+" Z"));h+=i}return d.attr({stroke:"#ccc","stroke-width":1}).toBack()};return f})();var x;s=function(f,a){return function(){return f.apply(a,arguments)}};x=function(){function f(a,c,b,d){this.r=a;this.point=c;this.opts=b;this.scale_factor=d!=null?d:1.5;this.element=this.r.circle(c.x,c.y,this.opts.dot_size);this.style_dot();this.attach_handlers()}f.prototype.style_dot=function(){this.element.attr({fill:this.opts.dot_color,stroke:this.opts.dot_stroke_color,"stroke-width":this.opts.dot_stroke_size});
return this.element.toFront()};f.prototype.activate=function(){this.element.attr({fill:"#333"});return this.element.animate({r:this.opts.dot_size*this.scale_factor},200)};f.prototype.deactivate=function(){this.element.attr({fill:this.opts.dot_color});return this.element.animate({r:this.opts.dot_size},200)};f.prototype.attach_handlers=function(){this.element.mouseover(s(function(){return this.activate()},this));return this.element.mouseout(s(function(){return this.deactivate()},this))};return f}();
var w;w=function(){function f(){}f.create_path=function(a,c){var b,d,e,g,h;if(c==null)c=0.7;g="";e=0;for(h=a.length;e<h;e++){b=a[e];if(e===0)g+="M"+b.x+","+b.y;else{d=f.get_control_points(a,e-1,c);b=d[0];d=d[1];g+="M"+a[e-1].x+","+a[e-1].y+" C"+b.x+","+b.y+" "+d.x+","+d.y+" "+a[e].x+","+a[e].y}}return g};f.get_control_points=function(a,c,b){var d;d=f.get_control_point(a,c,b);b=f.get_control_point(a,c+1,b);d=new l(a[c].x+d.x/3,a[c].y+d.y/3);a=new l(a[c+1].x-b.x/3,a[c+1].y-b.y/3);return[d,a]};f.get_control_point=
function(a,c,b){var d,e;if(a.length<2)throw"Error";d=c+1;e=c-1;if(c===0){d=1;e=0}else if(c===a.length-1){d=c;e=c-1}return new l((a[d].x-a[e].x)*b,(a[d].y-a[e].y)*b)};return f}();n.Bezier=w;var y;y=function(){function f(a,c,b,d,e,g){this.r=a;this.raw_points=c;this.scaled_points=b;this.height=d;this.width=e;this.options=g!=null?g:{}}f.prototype.draw=function(){this.options.fill_area&&this.draw_area();this.draw_curve();this.options.dot_size>0&&this.draw_dots_and_tooltips(this.scaled_points,this.raw_points)};
f.prototype.draw_curve=function(){return this.r.path(w.create_path(this.scaled_points,this.options.smoothing)).attr({stroke:this.options.line_color,"stroke-width":this.options.line_width}).toFront()};f.prototype.draw_area=function(){var a,c,b,d,e,g,h,i;h=this.scaled_points;d=this.height-this.options.y_padding;a=h[h.length-1];c=h[0];e="";b=0;for(i=h.length;b<i;b++){g=h[b];e+=b===0?"M "+c.x+", "+c.y:"L "+g.x+", "+g.y}e+="M "+a.x+", "+a.y;e+="L "+a.x+", "+d;e+="L "+c.x+", "+d;e+="L "+c.x+", "+c.y;e+=
"Z";a=this.r.path(e);a.attr({fill:this.options.area_color,"fill-opacity":this.options.area_opacity,stroke:"none"});return a.toBack()};f.prototype.draw_dots_and_tooltips=function(){var a,c,b,d,e,g,h,i,j;h=this.scaled_points;g=this.raw_points;i=[];a=[];c=d=b=0;for(j=h.length;c<j;c++){e=h[c];a.push(new x(this.r,e,this.options));i.push(new u(this.r,a[c].element,g[c].y));if(g[c].y>=g[b].y)b=c;if(g[c].y<g[d].y)d=c}if(this.options.label_max){i[b].show();a[b].activate()}if(this.options.label_min){i[d].show();
return a[d].activate()}};return f}();var z;z=function(){function f(a,c){var b,d;if(c==null)c={};b=document.getElementById(a);d=this.get_dimensions(b);this.width=d[0];this.height=d[1];this.padding=26;this.options=new t(c);this.r=Raphael(b,this.width,this.height);this.all_points=[];this.line_indices=[];this.line_options=[]}f.prototype.get_dimensions=function(a){var c;c=parseInt(a.style.width);a=parseInt(a.style.height);return[c,a]};f.prototype.add_line=function(a){var c,b,d,e;b=a.data;if(!(b.length<
1)){d=function(){var g,h,i;i=[];g=0;for(h=b.length;g<h;g++){c=b[g];i.push(new l(c[0],c[1]))}return i}();e=this.all_points.length;this.line_indices.push([e,e+d.length-1]);this.all_points.push.apply(this.all_points,d);this.line_options.push(new t(a.options||this.options))}};f.prototype.draw_grid=function(a,c){var b,d,e,g,h,i;if(a==null)a=[];if(c==null)c=[];b=this.height-this.options.y_padding;g=this.width-this.options.x_padding;d=this.r.set();h=0;for(i=a.length;h<i;h++){e=a[h];d.push(this.r.path("M "+
e+", "+this.options.y_padding+" L "+e+", "+b+" Z"))}b=0;for(h=c.length;b<h;b++){e=c[b];d.push(this.r.path("M "+this.options.x_padding+", "+e+" L "+g+", "+e+" Z"))}return d.attr({stroke:"#ccc","stroke-width":1}).toBack()};f.prototype.draw_y_labels=function(){var a,c,b,d,e,g,h,i,j,p;(function(){var k,m,q,r;q=this.scaled_points;r=[];k=0;for(m=q.length;k<m;k++){i=q[k];r.push(i)}return r}).call(this).sort(function(k,m){return k.y-m.y});b=function(){var k,m,q,r;q=this.all_points;r=[];k=0;for(m=q.length;k<
m;k++){i=q[k];r.push(i)}return r}.call(this);b.sort(function(k,m){return k.y-m.y});c=this.options.label_format;j=this.options.y_label_size;h=j+5;e=this.options.max_y_labels;d=[];g=[];a=b[0].y;g.push(new l(0,a));b=b[b.length-1].y;g.push(new l(0,b));e=Math.round(b/(e-1));for(a=a+e;a<b;){g.push(new l(0,Math.round(a/10)*10));a+=e}e=o.scale_points(this.width,this.height,g,this.options.x_padding,this.options.y_padding);a=0;for(p=e.length;a<p;a++){b=e[a];(new v(this.r,h,b.y,g[a].y,c,j)).draw();d.push(b.y)}return d};
f.prototype.draw_x_label=function(a,c){var b,d;b=this.options.label_format;d=this.options.x_label_size;return(new v(this.r,c.x,this.height-d,a.is_date_type===true?new Date(a.x):Math.round(a.x),b,d)).draw()};f.prototype.draw_x_labels=function(a,c){var b,d,e,g,h,i;d=[];g=this.options.max_x_labels;this.draw_x_label(a[0],c[0]);d.push(c[0].x);if(!(g<2)){e=c.length-1;this.draw_x_label(a[e],c[e]);d.push(c[e].x);if(!(g<3)){e=c.length-2;g=e/(g-1);b=Math.round(g);if(g!==b)g=b+1;for(b=g;b<e;){i=a[b];h=c[b];
this.draw_x_label(i,h);d.push(h.x);b+=g}return d}}};f.prototype.draw_line=function(a,c,b){return(new y(this.r,a,c,this.height,this.width,b)).draw()};f.prototype.draw=function(){var a,c,b,d,e,g;if(!(this.all_points.length<1)){this.r.clear();this.scaled_points=o.scale_points(this.width,this.height,this.all_points,this.options.x_padding,this.options.y_padding);g=this.line_indices;b=0;for(e=g.length;b<e;b++){d=g[b];a=d[0];c=d[1];d=this.scaled_points.slice(a,c+1||9E9);c=this.all_points.slice(a,c+1||9E9);
a=this.line_options[b];this.draw_line(c,d,a);if(b===0){if(this.options.show_x_labels===true)this.x_label_coordinates=this.draw_x_labels(c,d);if(this.options.show_y_labels===true)this.y_label_coordinates=this.draw_y_labels();this.options.show_grid===true&&this.draw_grid(this.x_label_coordinates,this.y_label_coordinates)}}}};return f}();n.LineChart=z});})();
