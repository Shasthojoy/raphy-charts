(function(){var global=window;if(global.module==undefined)global.module=function(k,o){var l=global[k];if(l==undefined)global[k]=l={};o(l)};
module("Charts",function(k){var o;o=function(){function f(a){var b,d,c,e;d={};e=f.DEFAULTS;for(b in e){c=e[b];d[b]=c}for(b in a){c=a[b];if(a.hasOwnProperty(b))d[b]=c}return d}f.DEFAULTS={dot_size:5,dot_color:"#00aadd",dot_stroke_color:"#fff",dot_stroke_size:2,line_width:3,line_color:"#00aadd",smoothing:0.4,fill_area:true,area_color:"#00aadd",area_opacity:0.2,label_max:true,label_min:true,step_size:3,x_padding:25,y_padding:40};return f}();var l;l=function(){function f(){}f.get_ranges_for_points=function(a){var b,
d,c,e,g;d=[];c=[];e=0;for(g=a.length;e<g;e++){b=a[e];d.push(b.x);c.push(b.y)}a=Math.max.apply(Math.max,d);b=Math.max.apply(Math.max,c);d=Math.min.apply(Math.min,d);c=Math.min.apply(Math.min,c);return[a,d,b,c]};f.calc_scaling_factors=function(a,b,d,c){var e;e=a-b;return[(a*c-d*b)/e,(d-c)/e]};f.scale_points=function(a,b,d,c,e){var g,h,i,j,p,s;j=f.get_ranges_for_points(d);g=j[0];i=j[1];h=j[2];j=j[3];c=f.calc_scaling_factors(g,i,a-c,c);a=c[0];c=c[1];h=f.calc_scaling_factors(h,j,b-e,e);e=h[0];g=h[1];h=
[];i=0;for(s=d.length;i<s;i++){p=d[i];j=a+p.x*c;p=b-(e+p.y*g);h.push(new m(j,p))}return h};return f}();k.Scaling=l;var m;m=function(){return function(f,a){this.x=f;this.y=a}}();k.Point=m;var q,n=function(f,a){return function(){return f.apply(a,arguments)}};Raphael.fn.triangle=function(f,a,b){b*=1.75;return this.path("M".concat(f,",",a,"m0-",b*0.58,"l",b*0.5,",",b*0.87,"-",b,",0z"))};q=function(){function f(a,b,d){var c,e;this.r=a;c=b.getBBox();e=c.x;a=c.y;c=e+c.width/2;this.popup=this.r.set();this.popup.push(this.r.rect(c-
25,a-35,50,25,5));this.popup.push(this.r.triangle(c,a-10+4,4).rotate(180));this.popup.attr({fill:"rgba(0,0,0,.4)","fill-opacity":0,stroke:"transparent","stroke-width":0});this.text=this.r.text(c,a-22.5,d);this.text.attr({fill:"#fff","font-size":14,"text-anchor":"middle",width:50,height:25,"fill-opacity":0,"font-weight":"bold"});this.popup.toFront();this.text.toFront();b.mouseover(n(function(){return this.show()},this));b.mouseout(n(function(){return this.hide()},this))}f.prototype.animate_opacity=
function(a,b,d){if(d==null)d=200;return a.animate({"fill-opacity":b},d,n(function(){if(b===0){this.text.toBack();return this.popup.toBack()}},this))};f.prototype.hide=function(){this.animate_opacity(this.popup,0);return this.animate_opacity(this.text,0)};f.prototype.show=function(){this.popup.toFront();this.text.toFront();this.animate_opacity(this.popup,0.8);return this.animate_opacity(this.text,1)};return f}();k.Tooltip=q;var t;t=function(){function f(a,b,d,c){this.r=a;this.height=b;this.x=d;this.text=
c;this.size=14}f.prototype.is_date=function(a){return Object.prototype.toString.call(a)==="[object Date]"};f.prototype.parse_date=function(a){return""+(a.getMonth()+1)+"/"+a.getDate()};f.prototype.draw=function(){this.element=this.r.text(this.x,this.height-this.size,this.is_date(this.text)?this.parse_date(this.text):this.text);return this.element.attr({fill:"#333","font-size":this.size,"font-weight":"bold"})};return f}();var u;u=function(){function f(a,b,d,c,e){this.r=a;this.width=b;this.height=d;
this.points=c;this.options=e}f.prototype.draw=function(){var a,b,d,c,e,g,h,i,j;a=Math.round(this.points.length/this.options.step_size);b=this.height-this.options.y_padding;e=this.width-this.options.x_padding;i=Math.round(b/a);h=this.options.y_padding;c=this.r.set();g=this.points;d=0;for(j=g.length;d<j;d++)if(d%this.options.step_size===0){g=this.points[d].x;c.push(this.r.path("M "+g+", "+this.options.y_padding+" L "+g+", "+b+" Z"))}for(d=0;0<=a?d<=a:d>=a;0<=a?d++:d--){h<=b&&c.push(this.r.path("M "+
this.options.x_padding+", "+h+" L "+e+", "+h+" Z"));h+=i}return c.attr({stroke:"#ccc","stroke-width":1}).toBack()};return f}();var v;n=function(f,a){return function(){return f.apply(a,arguments)}};v=function(){function f(a,b,d,c){this.r=a;this.point=b;this.opts=d;this.scale_factor=c!=null?c:1.5;this.element=this.r.circle(b.x,b.y,this.opts.dot_size);this.style_dot();this.attach_handlers()}f.prototype.style_dot=function(){this.element.attr({fill:this.opts.dot_color,stroke:this.opts.dot_stroke_color,
"stroke-width":this.opts.dot_stroke_size});return this.element.toFront()};f.prototype.activate=function(){this.element.attr({fill:"#333"});return this.element.animate({r:this.opts.dot_size*this.scale_factor},200)};f.prototype.deactivate=function(){this.element.attr({fill:this.opts.dot_color});return this.element.animate({r:this.opts.dot_size},200)};f.prototype.attach_handlers=function(){this.element.mouseover(n(function(){return this.activate()},this));return this.element.mouseout(n(function(){return this.deactivate()},
this))};return f}();var r;r=function(){function f(){}f.create_path=function(a,b){var d,c,e,g,h;if(b==null)b=0.7;g="";e=0;for(h=a.length;e<h;e++){d=a[e];if(e===0)g+="M"+d.x+","+d.y;else{c=f.get_control_points(a,e-1,b);d=c[0];c=c[1];g+="M"+a[e-1].x+","+a[e-1].y+" C"+d.x+","+d.y+" "+c.x+","+c.y+" "+a[e].x+","+a[e].y}}return g};f.get_control_points=function(a,b,d){var c;c=f.get_control_point(a,b,d);d=f.get_control_point(a,b+1,d);c=new m(a[b].x+c.x/3,a[b].y+c.y/3);a=new m(a[b+1].x-d.x/3,a[b+1].y-d.y/3);
return[c,a]};f.get_control_point=function(a,b,d){var c,e;if(a.length<2)throw"Error";c=b+1;e=b-1;if(b===0){c=1;e=0}else if(b===a.length-1){c=b;e=b-1}return new m((a[c].x-a[e].x)*d,(a[c].y-a[e].y)*d)};return f}();k.Bezier=r;var w;w=function(){function f(a,b,d,c,e,g){this.r=a;this.raw_points=b;this.scaled_points=d;this.height=c;this.width=e;this.options=g!=null?g:{}}f.prototype.draw=function(){this.options.fill_area&&this.draw_area();this.draw_curve();this.draw_dots_and_tooltips(this.scaled_points,this.raw_points)};
f.prototype.draw_curve=function(){return this.r.path(r.create_path(this.scaled_points,this.options.smoothing)).attr({stroke:this.options.line_color,"stroke-width":this.options.line_width}).toFront()};f.prototype.draw_area=function(){var a,b,d,c,e,g,h,i;h=this.scaled_points;c=this.height-this.options.y_padding;a=h[h.length-1];b=h[0];e="";d=0;for(i=h.length;d<i;d++){g=h[d];e+=d===0?"M "+b.x+", "+b.y:"L "+g.x+", "+g.y}e+="M "+a.x+", "+a.y;e+="L "+a.x+", "+c;e+="L "+b.x+", "+c;e+="L "+b.x+", "+b.y;e+=
"Z";a=this.r.path(e);a.attr({fill:this.options.area_color,"fill-opacity":this.options.area_opacity,stroke:"none"});return a.toBack()};f.prototype.draw_dots_and_tooltips=function(){var a,b,d,c,e,g,h,i,j;h=this.scaled_points;g=this.raw_points;i=[];a=[];b=c=d=0;for(j=h.length;b<j;b++){e=h[b];a.push(new v(this.r,e,this.options));i.push(new q(this.r,a[b].element,g[b].y));if(g[b].y>=g[d].y)d=b;if(g[b].y<g[c].y)c=b}if(this.options.label_max){i[d].show();a[d].activate()}if(this.options.label_min){i[c].show();
return a[c].activate()}};return f}();var x;x=function(){function f(a,b){var d,c;if(b==null)b={};d=document.getElementById(a);c=this.get_dimensions(d);this.width=c[0];this.height=c[1];this.padding=26;this.options=new o(b);this.r=Raphael(d,this.width,this.height);this.all_points=[];this.line_indices=[];this.line_options=[];this.labels=[]}f.prototype.get_dimensions=function(a){var b;b=parseInt(a.style.width);a=parseInt(a.style.height);return[b,a]};f.prototype.add_line=function(a){var b,d,c,e;b=function(){var g,
h,i;h=a.data;i=[];c=0;for(g=h.length;c<g;c++){e=h[c];i.push(new m(c,e))}return i}();d=this.all_points.length;if(a.labels!=null)this.labels=a.labels;this.line_indices.push([d,d+b.length-1]);this.all_points.push.apply(this.all_points,b);this.line_options.push(new o(a.options||this.options))};f.prototype.draw_grid=function(a){return(new u(this.r,this.width,this.height,a,this.options)).draw()};f.prototype.draw_labels=function(a){var b,d,c,e;e=[];b=0;for(c=a.length;b<c;b++){d=a[b];e.push(b%this.options.step_size===
0?(new t(this.r,this.height,d.x,this.labels[b])).draw():void 0)}return e};f.prototype.draw_line=function(a,b,d){return(new w(this.r,a,b,this.height,this.width,d)).draw()};f.prototype.draw=function(){var a,b,d,c,e,g;this.r.clear();this.scaled_points=l.scale_points(this.width,this.height,this.all_points,this.options.x_padding,this.options.y_padding);g=this.line_indices;d=0;for(e=g.length;d<e;d++){c=g[d];a=c[0];b=c[1];c=this.scaled_points.slice(a,b+1||9E9);b=this.all_points.slice(a,b+1||9E9);a=this.line_options[d];
this.draw_line(b,c,a);if(d===0){this.options.show_grid===true&&this.draw_grid(c);this.labels.length===c.length&&this.draw_labels(c)}}};return f}();k.LineChart=x});})();
