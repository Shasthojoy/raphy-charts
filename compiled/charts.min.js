(function(){var global=window;if(global.module==undefined)global.module=function(m,s){var o=global[m];if(o==undefined)global[m]=o={};s(o)};
module("Charts",function(m){var s;s=function(){function f(c){var b,a,d,e;a={};e=f.DEFAULTS;for(b in e){d=e[b];a[b]=d}for(b in c){d=c[b];if(c.hasOwnProperty(b))a[b]=d}return a}f.DEFAULTS={dot_size:5,dot_color:"#00aadd",dot_stroke_color:"#fff",dot_stroke_size:2,line_width:3,line_color:"#00aadd",smoothing:0.4,fill_area:true,area_color:"#00aadd",area_opacity:0.2,show_x_labels:true,show_y_labels:true,label_max:true,label_min:true,max_x_labels:10,max_y_labels:3,font_family:"Helvetica, Arial, sans-serif",
x_label_size:14,y_label_size:14,label_format:"%m/%d",show_grid:false,x_padding:45,y_padding:40,render:"line",bar_width:20};f.merge=function(c,b){var a,d,e;if(c==null)c={};if(b==null)b={};d={};for(a in c){e=c[a];d[a]=e}for(a in b){e=b[a];if(b.hasOwnProperty(a))d[a]=e}return d};return f}();var o;Raphael.fn.triangle=function(f,c,b){b*=1.75;return this.path("M".concat(f,",",c,"m0-",b*0.58,"l",b*0.5,",",b*0.87,"-",b,",0z"))};o=function(){function f(c,b,a,d){var e,g,h=this;this.r=c;if(d==null)d=true;if(typeof a===
"number")a=Math.round(a*100)/100;e=b.getBBox();g=e.x;c=e.y;e=g+e.width/2;this.popup=this.r.set();this.popup.push(this.r.rect(e-25,c-35,50,25,5));this.popup.push(this.r.triangle(e,c-10+4,4).rotate(180));this.popup.attr({fill:"rgba(0,0,0,.4)","fill-opacity":0,stroke:"transparent","stroke-width":0});this.text=this.r.text(e,c-22.5,a);this.text.attr({fill:"#fff","font-size":14,"text-anchor":"middle",width:50,height:25,"fill-opacity":0,"font-weight":"bold"});this.popup.toFront();this.text.toFront();if(d===
true){b.mouseover(function(){return h.show()});b.mouseout(function(){return h.hide()})}}f.prototype.animate_opacity=function(c,b,a){var d=this;if(a==null)a=200;return c.animate({"fill-opacity":b},a,function(){if(b===0){d.text.toBack();return d.popup.toBack()}})};f.prototype.hide=function(){this.animate_opacity(this.popup,0);return this.animate_opacity(this.text,0)};f.prototype.show=function(){this.popup.toFront();this.text.toFront();this.animate_opacity(this.popup,0.8);return this.animate_opacity(this.text,
1)};return f}();m.Tooltip=o;(function(){function f(c,b,a,d,e){this.r=c;this.width=b;this.height=a;this.points=d;this.options=e}f.prototype.draw=function(){var c,b,a,d,e,g,h,i,j;c=Math.round(this.points.length/this.options.step_size);b=this.height-this.options.y_padding;e=this.width-this.options.x_padding;i=Math.round(b/c);h=this.options.y_padding;d=this.r.set();g=this.points;a=0;for(j=g.length;a<j;a++)if(a%this.options.step_size===0){g=this.points[a].x;d.push(this.r.path("M "+g+", "+this.options.y_padding+
" L "+g+", "+b+" Z"))}for(a=0;0<=c?a<=c:a>=c;0<=c?a++:a--){h<=b&&d.push(this.r.path("M "+this.options.x_padding+", "+h+" L "+e+", "+h+" Z"));h+=i}return d.attr({stroke:"#ccc","stroke-width":1}).toBack()};return f})();var A;A=function(){function f(c,b,a,d){this.r=c;this.point=b;this.opts=a;this.scale_factor=d!=null?d:1.5;this.element=this.r.circle(b.x,b.y,this.opts.dot_size);this.style_dot();this.attach_handlers()}f.prototype.style_dot=function(){this.element.attr({fill:this.opts.dot_color,stroke:this.opts.dot_stroke_color,
"stroke-width":this.opts.dot_stroke_size});return this.element.toFront()};f.prototype.activate=function(){this.element.attr({fill:"#333"});return this.element.animate({r:this.opts.dot_size*this.scale_factor},200)};f.prototype.deactivate=function(){this.element.attr({fill:this.opts.dot_color});return this.element.animate({r:this.opts.dot_size},200)};f.prototype.attach_handlers=function(){var c=this;this.element.mouseover(function(){return c.activate()});return this.element.mouseout(function(){return c.deactivate()})};
return f}();var B;B=function(){function f(c){var b,a,d,e;a={};e=f.DEFAULTS;for(b in e){d=e[b];a[b]=d}for(b in c){d=c[b];if(c.hasOwnProperty(b))a[b]=d}return a}f.DEFAULTS={line_width:4,line_color:"#000",area_color:"#00aadd",area_width:20,area_opacity:0.2,bar_margin:8,show_average:true,average_width:4,average_height:8,average_color:"#000",font_family:"Helvetica, Arial, sans-serif",x_label_size:14,y_label_size:14,x_padding:45,y_padding:40};f.merge=function(c,b){var a,d,e;if(c==null)c={};if(b==null)b=
{};d={};for(a in c){e=c[a];d[a]=e}for(a in b){e=b[a];if(b.hasOwnProperty(a))d[a]=e}return d};return f}();var q;q=function(){function f(c,b,a,d,e,g,h,i){this.r=c;this.x=b;this.y=a;this.text=d;this.format=e;this.size=g!=null?g:14;this.font_family=h;this.color=i!=null?i:"#333"}f.prototype.is_date=function(c){return Object.prototype.toString.call(c)==="[object Date]"};f.prototype.parse_date=function(){var c,b,a,d,e;b=this.format.match(/%([a-zA-Z])/g);c=this.format;d=0;for(e=b.length;d<e;d++){a=b[d];c=
c.replace(a,this.parse_format(a))}return c};f.prototype.meridian_indicator=function(c){return c.getHours()>=12?"pm":"am"};f.prototype.to_12_hour_clock=function(c){c=c.getHours()%12;return c===0?12:c};f.prototype.format_number=function(c){if(c>1E6){c=c/1E6;c=Math.round(c*100)/100;return c+"m"}else if(c>1E3){c=c/1E3;return Math.round(c*10)/10+"k"}else return Math.round(c*10)/10};f.prototype.fmt_minutes=function(c){c=c.getMinutes();return c<10?"0"+c:c};f.prototype.parse_format=function(c){switch(c){case "%m":return this.text.getMonth()+
1;case "%d":return this.text.getDate();case "%Y":return this.text.getFullYear();case "%H":return this.text.getHours();case "%M":return this.fmt_minutes(this.text);case "%I":return this.to_12_hour_clock(this.text);case "%p":return this.meridian_indicator(this.text)}};f.prototype.draw=function(){var c;this.element=this.r.text(this.x,this.y,this.is_date(this.text)?this.parse_date(this.text):typeof this.text==="number"?this.format_number(this.text):this.text);c=this.element.getBBox().width;return this.element.attr({fill:this.color,
"font-size":this.size,"font-weight":"bold",x:this.x<c?c/2+5:this.x,"text-anchor":"middle","font-family":this.font_family})};return f}();var w;w=function(){function f(c){var b,a,d,e;a={};e=f.DEFAULTS;for(b in e){d=e[b];a[b]=d}for(b in c){d=c[b];if(c.hasOwnProperty(b))a[b]=d}return a}f.DEFAULTS={bar_width:20,bar_spacing:20,bar_color:"#00aadd",rounding:0,font_family:"Helvetica, Arial, sans-serif",show_x_labels:true,show_y_labels:true,x_label_size:14,x_label_color:"#333",y_label_size:14,y_label_color:"#333",
show_grid:false,x_padding:25,y_padding:40};f.merge=function(c,b){var a,d,e;if(c==null)c={};if(b==null)b={};d={};for(a in c){e=c[a];d[a]=e}for(a in b){e=b[a];if(b.hasOwnProperty(a))d[a]=e}return d};return f}();var p;p=function(){function f(){}f.get_ranges_for_points=function(c){var b,a,d,e,g;a=[];d=[];e=0;for(g=c.length;e<g;e++){b=c[e];a.push(b.x);d.push(b.y)}c=Math.max.apply(Math.max,a);b=Math.max.apply(Math.max,d);a=Math.min.apply(Math.min,a);d=Math.min.apply(Math.min,d);return[c,a,b,d]};f.calc_scaling_factors=
function(c,b,a,d){var e;e=c-b;return[(c*d-a*b)/e,(a-d)/e]};f.scale_points=function(c,b,a,d,e){var g,h,i,j,l,n;j=f.get_ranges_for_points(a);g=j[0];i=j[1];h=j[2];j=j[3];if(j===h)h+=1;if(i===g)g+=1;d=f.calc_scaling_factors(g,i,c-d,d);c=d[0];d=d[1];h=f.calc_scaling_factors(h,j,b-e,e);e=h[0];g=h[1];h=[];i=0;for(n=a.length;i<n;i++){l=a[i];j=c+l.x*d;l=b-(e+l.y*g);h.push(new k(j,l))}return h};return f}();m.Scaling=p;var C;C=function(){function f(c,b,a,d,e,g){this.r=c;this.raw_points=b;this.scaled_points=
a;this.height=d;this.width=e;this.options=g!=null?g:{};this.effective_height=this.height-this.options.y_padding;this.x_offset=this.options.bar_width/2}f.prototype.draw=function(){return this.draw_bars()};f.prototype.draw_bars=function(){var c,b,a,d,e,g,h,i,j;e=this.r.set();g=[];a=b=0;j=this.scaled_points;c=0;for(i=j.length;c<i;c++){d=j[c];h=d.x-this.x_offset;d=this.r.rect(h,d.y,this.options.bar_width,this.effective_height-d.y);e.push(d);g.push(new o(this.r,d,this.raw_points[c].y));if(this.raw_points[c].y>=
this.raw_points[b].y)b=c;if(this.raw_points[c].y<this.raw_points[a].y)a=c}e.attr({fill:this.options.line_color,stroke:"none"});this.options.label_max&&g[b].show();if(this.options.label_min)return g[a].show()};return f}();var k;k=function(){function f(c,b){this.y=b;if(this.is_date(c)){this.x=c.getTime();this.is_date_type=true}else this.x=c}f.prototype.is_date=function(c){return Object.prototype.toString.call(c)==="[object Date]"};return f}();m.Point=k;var x;x=function(){function f(){}f.create_path=
function(c,b){var a,d,e,g,h;if(b==null)b=0.5;g="M"+c[0].x+", "+c[0].y;e=0;for(h=c.length;e<h;e++)if(e!==0){d=f.get_control_points(c,e-1,b);a=d[0];d=d[1];g+="C"+a.x+","+a.y+" "+d.x+","+d.y+" "+c[e].x+","+c[e].y}return g};f.get_control_points=function(c,b,a,d){var e,g,h,i;if(d==null)d=3;g=this.get_prev_and_next_points(c,b);e=g[0];g=g[1];b=this.get_prev_and_next_points(c,b+1);c=b[0];h=b[1];b=this.get_tangent(e,g);e=b[0];b=b[1];i=this.get_tangent(c,h);h=i[0];i=i[1];e=c.x+e*a/d;c=c.y+b*a/d;b=g.x-h*a/d;
a=g.y-i*a/d;d=new k(e,c);a=new k(b,a);return[d,a]};f.get_prev_and_next_points=function(c,b){var a,d;d=b-1;a=b+1;if(d<0)d=0;if(a>=c.length)a=c.length-1;return[c[d],c[a]]};f.get_tangent=function(c,b){return[b.x-c.x,b.y-c.y]};return f}();m.Bezier=x;var D;D=function(){function f(c,b,a,d,e,g){this.r=c;this.raw_points=b;this.scaled_points=a;this.height=d;this.width=e;this.options=g!=null?g:{}}f.prototype.draw=function(){var c;c=x.create_path(this.scaled_points,this.options.smoothing);this.options.fill_area&&
this.draw_area(c);this.draw_curve(c);this.options.dot_size>0&&this.draw_dots_and_tooltips(this.scaled_points,this.raw_points)};f.prototype.draw_curve=function(c){return this.r.path(c).attr({stroke:this.options.line_color,"stroke-width":this.options.line_width}).toFront()};f.prototype.draw_area=function(c){var b,a,d;a=this.scaled_points;d=this.height-this.options.y_padding;b=a[a.length-1];a=a[0];c+="L "+b.x+", "+d+" ";c+="L "+a.x+", "+d+" ";c+="Z";c=this.r.path(c);c.attr({fill:this.options.area_color,
"fill-opacity":this.options.area_opacity,"stroke-width":0});return c.toBack()};f.prototype.draw_dots_and_tooltips=function(){var c,b,a,d,e,g,h,i,j;h=this.scaled_points;g=this.raw_points;i=[];c=[];b=d=a=0;for(j=h.length;b<j;b++){e=h[b];c.push(new A(this.r,e,this.options));i.push(new o(this.r,c[b].element,g[b].y));if(g[b].y>=g[a].y)a=b;if(g[b].y<g[d].y)d=b}if(this.options.label_max){i[a].show();c[a].activate()}if(this.options.label_min){i[d].show();return c[d].activate()}};return f}();var r;r=function(){function f(c,
b){var a,d;a=document.getElementById(c);d=this.get_dimensions(a);this.width=d[0];this.height=d[1];this.r=Raphael(a,this.width,this.height);this.options=b}f.prototype.get_dimensions=function(c){var b;b=parseInt(c.style.width);c=parseInt(c.style.height);return[b,c]};return f}();var v,t=Object.prototype.hasOwnProperty,u=function(f,c){function b(){this.constructor=f}for(var a in c)if(t.call(c,a))f[a]=c[a];b.prototype=c.prototype;f.prototype=new b;f.__super__=c.prototype;return f};v=function(f){function c(b,
a){if(a==null)a={};c.__super__.constructor.call(this,b,new s(a));this.padding=26;this.all_points=[];this.line_indices=[];this.line_options=[]}u(c,f);c.prototype.add_line=function(b){var a,d,e,g;d=b.data;if(!(d.length<1)){e=function(){var h,i,j;j=[];h=0;for(i=d.length;h<i;h++){a=d[h];j.push(new k(a[0],a[1]))}return j}();g=this.all_points.length;this.line_indices.push([g,g+e.length-1]);this.all_points.push.apply(this.all_points,e);this.line_options.push(s.merge(this.options,b.options))}};c.prototype.draw_grid=
function(b,a){var d,e,g,h,i,j;if(b==null)b=[];if(a==null)a=[];d=this.height-this.options.y_padding;h=this.width-this.options.x_padding;e=this.r.set();i=0;for(j=b.length;i<j;i++){g=b[i];e.push(this.r.path("M "+g+", "+this.options.y_padding+" L "+g+", "+d+" Z"))}d=0;for(i=a.length;d<i;d++){g=a[d];e.push(this.r.path("M "+this.options.x_padding+", "+g+" L "+h+", "+g+" Z"))}return e.attr({stroke:"#ccc","stroke-width":1}).toBack()};c.prototype._draw_y_labels=function(b){var a,d,e,g,h,i,j,l,n;a=this.options.label_format;
l=this.options.y_label_size;d=this.options.font_family;i=l+5;j=p.scale_points(this.width,this.height,b,this.options.x_padding,this.options.y_padding);h=[];e=0;for(n=j.length;e<n;e++){g=j[e];(new q(this.r,i,g.y,b[e].y,a,l,d)).draw();h.push(g.y)}return h};c.prototype.calc_y_label_step_size=function(b,a,d){if(d==null)d=this.options.max_y_labels;b=(a-b)/(d-1);if(a>1){b=Math.round(b);if(b===0)b=1}return b};c.prototype.draw_y_labels=function(){var b,a,d,e;e=p.get_ranges_for_points(this.all_points);a=e[2];
b=e[3];if(a===b)return this._draw_y_labels([new k(0,a)]);e=b;d=this.calc_y_label_step_size(b,a);for(b=[];e<=a;){b.push(new k(0,e));e+=d}if(a>1)b[b.length-1].y=Math.round(a);return this._draw_y_labels(b)};c.prototype.draw_x_label=function(b,a){var d,e,g;d=this.options.label_format;g=this.options.x_label_size;e=this.options.font_family;return(new q(this.r,a.x,this.height-g,b.is_date_type===true?new Date(b.x):Math.round(b.x),d,g,e)).draw()};c.prototype.draw_x_labels=function(b,a){var d,e,g,h,i,j;e=[];
h=this.options.max_x_labels;this.draw_x_label(b[0],a[0]);e.push(a[0].x);if(!(h<2)){g=a.length-1;this.draw_x_label(b[g],a[g]);e.push(a[g].x);if(!(h<3)){g=a.length-2;h=g/(h-1);d=Math.round(h);if(h!==d)h=d+1;for(d=h;d<g;){j=b[d];i=a[d];this.draw_x_label(j,i);e.push(i.x);d+=h}return e}}};c.prototype.draw_line=function(b,a,d){return this.options.render==="bar"?(new C(this.r,b,a,this.height,this.width,d)).draw():(new D(this.r,b,a,this.height,this.width,d)).draw()};c.prototype.draw=function(){var b,a,d,
e,g,h;if(!(this.all_points.length<1)){this.r.clear();this.scaled_points=p.scale_points(this.width,this.height,this.all_points,this.options.x_padding,this.options.y_padding);h=this.line_indices;d=0;for(g=h.length;d<g;d++){e=h[d];b=e[0];a=e[1];e=this.scaled_points.slice(b,a+1||9E9);a=this.all_points.slice(b,a+1||9E9);b=this.line_options[d];this.draw_line(a,e,b);if(d===0){if(this.options.show_x_labels===true)this.x_label_coordinates=this.draw_x_labels(a,e);if(this.options.show_y_labels===true)this.y_label_coordinates=
this.draw_y_labels();this.options.show_grid===true&&this.draw_grid(this.x_label_coordinates,this.y_label_coordinates)}}}};return c}(r);m.LineChart=v;var y;t=Object.prototype.hasOwnProperty;u=function(f,c){function b(){this.constructor=f}for(var a in c)if(t.call(c,a))f[a]=c[a];b.prototype=c.prototype;f.prototype=new b;f.__super__=c.prototype;return f};y=function(f,c,b,a){return{label:f,value:c,average:b,comparison:a}};v=function(f){function c(b,a){if(a==null)a={};c.__super__.constructor.call(this,
b,new B(a));this.bars=[]}u(c,f);c.prototype.add=function(){return this.bars.push(y.apply(y,arguments))};c.prototype.draw_background=function(b,a){return this.r.rect(this.options.x_padding,a,b.x,this.options.area_width).attr({fill:this.options.area_color,"stroke-width":0})};c.prototype.draw_line=function(b,a){return this.r.rect(this.options.x_padding,a.y-this.options.line_width/2,b.x,this.options.line_width).attr({fill:this.options.line_color,"stroke-width":0})};c.prototype.draw_average=function(b,
a){return this.r.rect(b.x-this.options.average_width/2,a-this.options.average_height/2,this.options.average_width,this.options.average_height).attr({fill:this.options.average_color,"stroke-width":0})};c.prototype.draw_label=function(){};c.prototype.draw=function(){var b,a,d,e,g,h,i,j;i=this.bars;j=[];a=0;for(h=i.length;a<h;a++){b=i[a];e=p.scale_points(this.width,this.height,[new k(b.comparison,0),new k(b.value,0),new k(b.average,0),new k(0,0)],this.options.x_padding,this.options.y_padding);g=a*(this.options.area_width+
this.options.bar_margin);this.draw_background(e[0],g);d=g+this.options.area_width/2;this.draw_line(e[1],new k(e[0].x,d));this.draw_average(e[2],d);j.push((new q(this.r,0,g+this.options.area_width/2,b.label,"",this.size=14,this.options.font_family)).draw())}return j};return c}(r);m.BulletChart=v;t=Object.prototype.hasOwnProperty;u=function(f,c){function b(){this.constructor=f}for(var a in c)if(t.call(c,a))f[a]=c[a];b.prototype=c.prototype;f.prototype=new b;f.__super__=c.prototype;return f};r=function(f){function c(b,
a){if(a==null)a={};c.__super__.constructor.call(this,b,new w(a));this.effective_height=this.height-this.options.y_padding;this.bar_options=[];this.bars=[];this.values=[]}u(c,f);c.prototype.add=function(b){var a,d;a=b.label;d=b.value;this.bar_options.push(w.merge(this.options,b.options));this.values.push(d);return this.bars.push({label:a,value:d})};c.prototype.render_bar=function(b,a,d,e){this.r.rect(d.x,d.y,this.options.bar_width,this.effective_height-d.y,this.options.rounding).attr({fill:e.bar_color,
"stroke-width":0});(new q(this.r,d.x+this.options.bar_width/2,this.height-(this.options.x_label_size+5),b,"",this.options.x_label_size,this.options.font_family,this.options.x_label_color)).draw();return(new q(this.r,d.x+this.options.bar_width/2,d.y-this.options.y_label_size-5,a,"",this.options.y_label_size,this.options.font_family,this.options.y_label_color)).draw()};c.prototype.draw=function(){var b,a,d,e,g,h,i,j;b=function(){var l,n,z;n=this.values;z=[];a=0;for(l=n.length;a<l;a++){g=n[a];z.push(new k(a,
g))}return z}.call(this);b.push(new k(0,0));this.scaled_values=p.scale_points(this.width,this.height,b,this.options.x_padding,this.options.y_padding);i=this.bars;j=[];a=0;for(h=i.length;a<h;a++){b=i[a];d=a*(this.options.bar_width+this.options.bar_spacing)+this.options.x_padding;e=this.scaled_values[a].y;d=new k(d,e);j.push(this.render_bar(b.label,b.value,d,this.bar_options[a]))}return j};return c}(r);m.BarChart=r});})();
