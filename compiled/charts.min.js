(function(){var global=window;if(global.module==undefined)global.module=function(n,s){var o=global[n];if(o==undefined)global[n]=o={};s(o)};
module("Charts",function(n){var s;s=function(){function g(a){var b,c,d,e;c={};e=g.DEFAULTS;for(b in e){d=e[b];c[b]=d}for(b in a){d=a[b];if(a.hasOwnProperty(b))c[b]=d}return c}g.DEFAULTS={dot_size:5,dot_color:"#00aadd",dot_stroke_color:"#fff",dot_stroke_size:2,line_width:3,line_color:"#00aadd",smoothing:0.4,fill_area:true,area_color:"#00aadd",area_opacity:0.2,show_x_labels:true,show_y_labels:false,label_max:true,label_min:true,max_x_labels:10,max_y_labels:8,x_label_size:14,y_label_size:14,label_format:"%m/%d",
show_grid:false,x_padding:25,y_padding:40};return g}();var o;o=function(){function g(){}g.get_ranges_for_points=function(a){var b,c,d,e,f;c=[];d=[];e=0;for(f=a.length;e<f;e++){b=a[e];c.push(b.x);d.push(b.y)}a=Math.max.apply(Math.max,c);b=Math.max.apply(Math.max,d);c=Math.min.apply(Math.min,c);d=Math.min.apply(Math.min,d);return[a,c,b,d]};g.calc_scaling_factors=function(a,b,c,d){var e;e=a-b;return[(a*d-c*b)/e,(c-d)/e]};g.scale_points=function(a,b,c,d,e){var f,h,i,k,j,l;k=g.get_ranges_for_points(c);
f=k[0];i=k[1];h=k[2];k=k[3];d=g.calc_scaling_factors(f,i,a-d,d);a=d[0];d=d[1];h=g.calc_scaling_factors(h,k,b-e,e);e=h[0];f=h[1];h=[];i=0;for(l=c.length;i<l;i++){j=c[i];k=a+j.x*d;j=b-(e+j.y*f);h.push(new m(k,j))}return h};return g}();n.Scaling=o;var m;m=function(){function g(a,b){this.y=b;if(this.is_date(a)){this.x=a.getTime();this.is_date_type=true}else this.x=a}g.prototype.is_date=function(a){return Object.prototype.toString.call(a)==="[object Date]"};return g}();n.Point=m;var t,r=function(g,a){return function(){return g.apply(a,
arguments)}};Raphael.fn.triangle=function(g,a,b){b*=1.75;return this.path("M".concat(g,",",a,"m0-",b*0.58,"l",b*0.5,",",b*0.87,"-",b,",0z"))};t=function(){function g(a,b,c){var d,e;this.r=a;d=b.getBBox();e=d.x;a=d.y;d=e+d.width/2;this.popup=this.r.set();this.popup.push(this.r.rect(d-25,a-35,50,25,5));this.popup.push(this.r.triangle(d,a-10+4,4).rotate(180));this.popup.attr({fill:"rgba(0,0,0,.4)","fill-opacity":0,stroke:"transparent","stroke-width":0});this.text=this.r.text(d,a-22.5,c);this.text.attr({fill:"#fff",
"font-size":14,"text-anchor":"middle",width:50,height:25,"fill-opacity":0,"font-weight":"bold"});this.popup.toFront();this.text.toFront();b.mouseover(r(function(){return this.show()},this));b.mouseout(r(function(){return this.hide()},this))}g.prototype.animate_opacity=function(a,b,c){if(c==null)c=200;return a.animate({"fill-opacity":b},c,r(function(){if(b===0){this.text.toBack();return this.popup.toBack()}},this))};g.prototype.hide=function(){this.animate_opacity(this.popup,0);return this.animate_opacity(this.text,
0)};g.prototype.show=function(){this.popup.toFront();this.text.toFront();this.animate_opacity(this.popup,0.8);return this.animate_opacity(this.text,1)};return g}();n.Tooltip=t;var u;u=function(){function g(a,b,c,d,e,f){this.r=a;this.x=b;this.y=c;this.text=d;this.format=e;this.size=f!=null?f:14}g.prototype.is_date=function(a){return Object.prototype.toString.call(a)==="[object Date]"};g.prototype.parse_date=function(){var a,b,c,d,e;b=this.format.match(/%([a-zA-Z])/g);a=this.format;d=0;for(e=b.length;d<
e;d++){c=b[d];a=a.replace(c,this.parse_format(c))}return a};g.prototype.parse_format=function(a){switch(a){case "%m":return this.text.getMonth()+1;case "%d":return this.text.getDate();case "%Y":return this.text.getFullYear();case "%H":return this.text.getHours();case "%M":return this.text.getMinutes()}};g.prototype.draw=function(){this.element=this.r.text(this.x,this.y,this.is_date(this.text)?this.parse_date(this.text):this.text);return this.element.attr({fill:"#333","font-size":this.size,"font-weight":"bold"})};
return g}();(function(){function g(a,b,c,d,e){this.r=a;this.width=b;this.height=c;this.points=d;this.options=e}g.prototype.draw=function(){var a,b,c,d,e,f,h,i,k;a=Math.round(this.points.length/this.options.step_size);b=this.height-this.options.y_padding;e=this.width-this.options.x_padding;i=Math.round(b/a);h=this.options.y_padding;d=this.r.set();f=this.points;c=0;for(k=f.length;c<k;c++)if(c%this.options.step_size===0){f=this.points[c].x;d.push(this.r.path("M "+f+", "+this.options.y_padding+" L "+
f+", "+b+" Z"))}for(c=0;0<=a?c<=a:c>=a;0<=a?c++:c--){h<=b&&d.push(this.r.path("M "+this.options.x_padding+", "+h+" L "+e+", "+h+" Z"));h+=i}return d.attr({stroke:"#ccc","stroke-width":1}).toBack()};return g})();var w;r=function(g,a){return function(){return g.apply(a,arguments)}};w=function(){function g(a,b,c,d){this.r=a;this.point=b;this.opts=c;this.scale_factor=d!=null?d:1.5;this.element=this.r.circle(b.x,b.y,this.opts.dot_size);this.style_dot();this.attach_handlers()}g.prototype.style_dot=function(){this.element.attr({fill:this.opts.dot_color,
stroke:this.opts.dot_stroke_color,"stroke-width":this.opts.dot_stroke_size});return this.element.toFront()};g.prototype.activate=function(){this.element.attr({fill:"#333"});return this.element.animate({r:this.opts.dot_size*this.scale_factor},200)};g.prototype.deactivate=function(){this.element.attr({fill:this.opts.dot_color});return this.element.animate({r:this.opts.dot_size},200)};g.prototype.attach_handlers=function(){this.element.mouseover(r(function(){return this.activate()},this));return this.element.mouseout(r(function(){return this.deactivate()},
this))};return g}();var v;v=function(){function g(){}g.create_path=function(a,b){var c,d,e,f,h;if(b==null)b=0.7;f="";e=0;for(h=a.length;e<h;e++){c=a[e];if(e===0)f+="M"+c.x+","+c.y;else{d=g.get_control_points(a,e-1,b);c=d[0];d=d[1];f+="M"+a[e-1].x+","+a[e-1].y+" C"+c.x+","+c.y+" "+d.x+","+d.y+" "+a[e].x+","+a[e].y}}return f};g.get_control_points=function(a,b,c){var d;d=g.get_control_point(a,b,c);c=g.get_control_point(a,b+1,c);d=new m(a[b].x+d.x/3,a[b].y+d.y/3);a=new m(a[b+1].x-c.x/3,a[b+1].y-c.y/3);
return[d,a]};g.get_control_point=function(a,b,c){var d,e;if(a.length<2)throw"Error";d=b+1;e=b-1;if(b===0){d=1;e=0}else if(b===a.length-1){d=b;e=b-1}return new m((a[d].x-a[e].x)*c,(a[d].y-a[e].y)*c)};return g}();n.Bezier=v;var x;x=function(){function g(a,b,c,d,e,f){this.r=a;this.raw_points=b;this.scaled_points=c;this.height=d;this.width=e;this.options=f!=null?f:{}}g.prototype.draw=function(){this.options.fill_area&&this.draw_area();this.draw_curve();this.draw_dots_and_tooltips(this.scaled_points,this.raw_points)};
g.prototype.draw_curve=function(){return this.r.path(v.create_path(this.scaled_points,this.options.smoothing)).attr({stroke:this.options.line_color,"stroke-width":this.options.line_width}).toFront()};g.prototype.draw_area=function(){var a,b,c,d,e,f,h,i;h=this.scaled_points;d=this.height-this.options.y_padding;a=h[h.length-1];b=h[0];e="";c=0;for(i=h.length;c<i;c++){f=h[c];e+=c===0?"M "+b.x+", "+b.y:"L "+f.x+", "+f.y}e+="M "+a.x+", "+a.y;e+="L "+a.x+", "+d;e+="L "+b.x+", "+d;e+="L "+b.x+", "+b.y;e+=
"Z";a=this.r.path(e);a.attr({fill:this.options.area_color,"fill-opacity":this.options.area_opacity,stroke:"none"});return a.toBack()};g.prototype.draw_dots_and_tooltips=function(){var a,b,c,d,e,f,h,i,k;h=this.scaled_points;f=this.raw_points;i=[];a=[];b=d=c=0;for(k=h.length;b<k;b++){e=h[b];a.push(new w(this.r,e,this.options));i.push(new t(this.r,a[b].element,f[b].y));if(f[b].y>=f[c].y)c=b;if(f[b].y<f[d].y)d=b}if(this.options.label_max){i[c].show();a[c].activate()}if(this.options.label_min){i[d].show();
return a[d].activate()}};return g}();var y;y=function(){function g(a,b){var c,d;if(b==null)b={};c=document.getElementById(a);d=this.get_dimensions(c);this.width=d[0];this.height=d[1];this.padding=26;this.options=new s(b);this.r=Raphael(c,this.width,this.height);this.all_points=[];this.line_indices=[];this.line_options=[]}g.prototype.get_dimensions=function(a){var b;b=parseInt(a.style.width);a=parseInt(a.style.height);return[b,a]};g.prototype.add_line=function(a){var b,c,d,e;c=a.data;d=function(){var f,
h,i;i=[];f=0;for(h=c.length;f<h;f++){b=c[f];i.push(new m(b[0],b[1]))}return i}();e=this.all_points.length;this.line_indices.push([e,e+d.length-1]);this.all_points.push.apply(this.all_points,d);this.line_options.push(new s(a.options||this.options))};g.prototype.draw_grid=function(a,b){var c,d,e,f,h,i;if(a==null)a=[];if(b==null)b=[];c=this.height-this.options.y_padding;f=this.width-this.options.x_padding;d=this.r.set();h=0;for(i=a.length;h<i;h++){e=a[h];d.push(this.r.path("M "+e+", "+this.options.y_padding+
" L "+e+", "+c+" Z"))}c=0;for(h=b.length;c<h;c++){e=b[c];d.push(this.r.path("M "+this.options.x_padding+", "+e+" L "+f+", "+e+" Z"))}return d.attr({stroke:"#ccc","stroke-width":1}).toBack()};g.prototype.draw_y_labels=function(){var a,b,c,d,e,f,h,i,k;(function(){var j,l,p,q;p=this.scaled_points;q=[];j=0;for(l=p.length;j<l;j++){h=p[j];q.push(h)}return q}).call(this).sort(function(j,l){return j.y-l.y});c=function(){var j,l,p,q;p=this.all_points;q=[];j=0;for(l=p.length;j<l;j++){h=p[j];q.push(h)}return q}.call(this);
c.sort(function(j,l){return j.y-l.y});b=this.options.label_format;i=this.options.y_label_size;d=this.options.max_y_labels;e=[];f=[];a=c[0].y;f.push(new m(0,a));c=c[c.length-1].y;f.push(new m(0,c));a=a;for(d=Math.round(c/(d-1));a<c;){f.push(new m(0,Math.round(a/10)*10));a+=d}a=o.scale_points(this.width,this.height,f,this.options.x_padding,this.options.y_padding);c=0;for(k=a.length;c<k;c++){d=a[c];(new u(this.r,i,d.y,f[c].y,b,i)).draw();e.push(d.y)}return e};g.prototype.draw_x_label=function(a,b){var c,
d;c=this.options.label_format;d=this.options.x_label_size;return(new u(this.r,b.x,this.height-d,a.is_date_type===true?new Date(a.x):Math.round(a.x),c,d)).draw()};g.prototype.draw_x_labels=function(a,b){var c,d,e,f,h,i;d=[];f=this.options.max_x_labels;this.draw_x_label(a[0],b[0]);d.push(b[0].x);if(!(f<2)){e=b.length-1;this.draw_x_label(a[e],b[e]);d.push(b[e].x);if(!(f<3)){e=b.length-2;f=e/(f-1);c=Math.round(f);if(f!==c)f=c+1;for(c=f;c<e;){i=a[c];h=b[c];this.draw_x_label(i,h);d.push(h.x);c+=f}return d}}};
g.prototype.draw_line=function(a,b,c){return(new x(this.r,a,b,this.height,this.width,c)).draw()};g.prototype.draw=function(){var a,b,c,d,e,f;this.r.clear();this.scaled_points=o.scale_points(this.width,this.height,this.all_points,this.options.x_padding,this.options.y_padding);f=this.line_indices;c=0;for(e=f.length;c<e;c++){d=f[c];a=d[0];b=d[1];d=this.scaled_points.slice(a,b+1||9E9);b=this.all_points.slice(a,b+1||9E9);a=this.line_options[c];this.draw_line(b,d,a);if(c===0){if(this.options.show_x_labels===
true)this.x_label_coordinates=this.draw_x_labels(b,d);if(this.options.show_y_labels===true)this.y_label_coordinates=this.draw_y_labels();this.options.show_grid===true&&this.draw_grid(this.x_label_coordinates,this.y_label_coordinates)}}};return g}();n.LineChart=y});})();
